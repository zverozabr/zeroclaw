# Εγχειρίδιο Διαχείρισης Proxy (Proxy Agent Playbook)

Αυτό το εγχειρίδιο περιέχει έτοιμες κλήσεις εργαλείων για τη διαμόρφωση της συμπεριφοράς διαμεσολάβησης (proxy) μέσω της ρύθμισης `proxy_config`.

## 0. Περίληψη

- **Σκοπός**: Παροχή προτύπων για τη διαχείριση της εμβέλειας του proxy και τη διασφάλιση της δυνατότητας επαναφοράς (rollback).
- **Κοινό**: Διαχειριστές συστημάτων και συντηρητές που λειτουργούν το ZeroClaw σε εταιρικά ή περιορισμένα δίκτυα.
- **Πεδίο Εφαρμογής**: Ενέργειες `proxy_config`, επιλογή λειτουργίας, επαλήθευση και επίλυση προβλημάτων.

---

## 1. Ταχείες Ενέργειες ανά Περίπτωση

### 1.1 Proxy μόνο για το ZeroClaw (Internal Traffic)

- **Περιγραφή**: Διαμεσολάβηση μόνο για την εσωτερική κίνηση του δαίμονα.
- **Εμβέλεια (Scope)**: `zeroclaw`.
- **Επαλήθευση**: Χρήση της ενέργειας `{"action":"get"}`.

### 1.2 Proxy για επιλεγμένες υπηρεσίες

- **Περιγραφή**: Διαμεσολάβηση μόνο για συγκεκριμένους παρόχους ή εργαλεία.
- **Εμβέλεια**: `services`.
- **Επαλήθευση**: Χρήση της ενέργειας `{"action":"list_services"}`.

### 1.3 Καθολική διαμεσολάβηση (Environment-wide)

- **Περιγραφή**: Εξαγωγή μεταβλητών περιβάλλοντος για όλη τη διεργασία.
- **Εμβέλεια**: `environment`.
- **Επαλήθευση**: Χρήση της ενέργειας `{"action":"apply_env"}`.

### 1.4 Άμεση Απενεργοποίηση (Emergency Rollback)

1. Απενεργοποιήστε τη διαμεσολάβηση.
2. Εκκαθαρίστε τις μεταβλητές περιβάλλοντος (εάν έχουν εξαχθεί).
3. Επαληθεύστε την κατάσταση του runtime.

---

## 2. Μήτρα Επιλογής Εμβέλειας (Scope)

| Εμβέλεια | Επηρεάζει | Περιβάλλον (Env) | Χρήση |
|:---|:---|:---:|:---|
| `zeroclaw` | Εσωτερικοί HTTP clients | Όχι | Αποφυγή παρενεργειών στο σύστημα. |
| `services` | Επιλεγμένα κλειδιά/selectors | Όχι | Δρομολόγηση για συγκεκριμένους παρόχους/εργαλεία. |
| `environment` | Full Process Runtime | Ναι | Ενσωματώσεις που απαιτούν `HTTP_PROXY`. |

---

## 3. Ροή Εργασίας Ασφαλούς Αλλαγής

1. **Επιθεώρηση**: Έλεγχος τρέχουσας κατάστασης.
2. **Ανακάλυψη**: Εύρεση έγκυρων κλειδιών υπηρεσιών.
3. **Εφαρμογή**: Ρύθμιση της επιθυμητής εμβέλειας.
4. **Επαλήθευση**: Έλεγχος στιγμιότυπων runtime και environment.

**Εντολές Ελέγχου**:
```json
{"action":"get"}
{"action":"list_services"}
```

---

## 4. Παραδείγματα Διαμόρφωσης

### Λειτουργία Α: Εσωτερική Διαμεσολάβηση (ZeroClaw only)

```json
{
  "action": "set",
  "enabled": true,
  "scope": "zeroclaw",
  "http_proxy": "http://127.0.0.1:7890",
  "https_proxy": "http://127.0.0.1:7890",
  "no_proxy": ["localhost", "127.0.0.1"]
}
```

### Λειτουργία Β: Στοχευμένη Διαμεσολάβηση (Services)

Χρήση συγκεκριμένων κλειδιών:
```json
{
  "action": "set",
  "enabled": true,
  "scope": "services",
  "services": ["provider.openai", "tool.http_request"],
  "all_proxy": "socks5h://127.0.0.1:1080"
}
```
Χρήση μπαλαντέρ (Wildcards):
```json
{
  "action": "set",
  "enabled": true,
  "scope": "services",
  "services": ["provider.*"]
}
```

### Λειτουργία Γ: Καθολική Διαμεσολάβηση (Process Environment)

```json
{
  "action": "set",
  "enabled": true,
  "scope": "environment",
  "http_proxy": "http://127.0.0.1:7890"
}
{"action":"apply_env"}
```

---

## 5. Απενεργοποίηση και Επαναφορά

### Απενεργοποίηση (Safe)

```json
{"action":"disable"}
```

### Πλήρης Εκκαθαρισμός Περιβάλλοντος

```json
{"action":"disable", "clear_env": true}
```

---

## 6. Αντιμετώπιση Προβλημάτων

- **Σφάλμα**: `proxy.scope='services' requires a non-empty proxy.services list`
  - *Λύση*: Προσθέστε τουλάχιστον ένα έγκυρο κλειδί ή selector.
- **Σφάλμα**: `Invalid proxy URL scheme`
  - *Λύση*: Χρησιμοποιήστε `http`, `https`, `socks5` ή `socks5h`.
- **Η διαμεσολάβηση δεν εφαρμόζεται**:
  - Εκτελέστε `list_services` για να επαληθεύσετε τα ονόματα των υπηρεσιών.
  - Ελέγξτε την έξοδο της `get` για τις τιμές `runtime_proxy` και `environment`.
